From: SeongJae Park <sj@kernel.org>
Date: Mon, 20 Jan 2025 13:43:38 -0800
Subject: [PATCH] ==== auto-tune monitoring parameters ====

mm/damon: auto-tune monitoring intervals aiming an amount of accesses

Roughly speaking, DAMON checks if each memory element (damon_region) is
accessed or not for every user-specified time interval called 'sampling
interval'.  It aggregates the check intervals on the per-element counter
called 'nr_accesses'.  DAMON users can read the counters to get the
monitoring results.  The counters are reset for every another
user-specified time interval called 'aggregation interval'.

In other words, DAMON generates monitoring results snapshot every
'aggregation interval'.  Hence the aggregation interval need to be
carefully decided.  If it is too short, each snapshot will show only
small amount of access.  If it is too long, snapshot is generated too
slowly, so no timely proactive access-aware operation can be made.
Adaptive regions adjustment mechanism also gets affected by
inappropriate length of aggregation interval.

The optimum length of the aggregation interval is not static, though.
It depends on how intensively the system and workloads are making
accesses.  Hence, users are required to do experiments based tuning of
the interval.  We recently added a guide for such tuning.  The guide is
that increase the interval if only insufficient amount of accesses are
shown in current snapshot, and vice versa.  Sampling interval to
aggregation interval ratio is better to be kept to avoid unnecessarily
increasing monitoring overhead.  Having the guide can help, but still
the tuning is time consuming work, and unreliable for workloads that
dynamically change the access intensiveness.

The tuning is challenging mainly because it is asking users to specify
how the mechanism should work, not what the mechanism should pursue.
The parameters system is asking users to know how DAMON should work to
achieve what they want (sufficient amount of accesses in each snapshot).
It requires users to fully understand DAMON's mechanism, and even the
characteristics of their workloads and systems.  Users shouldn't be
asked to understand and tune the mechanism but just specify what they
want.  Understanding the characteristics of the workloads and system is
what DAMON is supposed to do, not what users are supposed to.

Similar issue existed for DAMOS quotas, and it has mitigated by
introducing the aim-oriented feedback-driven auto-tuning of DAMOS
quotas.  Introduce a similar aim-oriented feedback-driven aggregation
and sampling intervals auto-tuning feature.  It defines the ratio of
positive access check sampling operations as the target metric.  Users
can set the target.  It should be easier to set the optimum value.  For
example, based on the Pareto principle, about 20% ratio could be used.
If the user aims to find more hot pages, the value can be higher, and
vice versa.  Then the auto-tuning feature periodically measures the
metric value and use a simple proportional feedback loop to find the
optimum value for the target.

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 hkml_cv_bogus/hkml_cv_bogus_448v7nrp | 0
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 hkml_cv_bogus/hkml_cv_bogus_448v7nrp

diff --git a/hkml_cv_bogus/hkml_cv_bogus_448v7nrp b/hkml_cv_bogus/hkml_cv_bogus_448v7nrp
new file mode 100644
index 000000000000..e69de29bb2d1
-- 
2.39.5

