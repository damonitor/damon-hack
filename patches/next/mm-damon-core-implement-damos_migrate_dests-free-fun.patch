From: SeongJae Park <sj@kernel.org>
Date: Sun, 7 Sep 2025 20:57:41 -0700
Subject: [PATCH] mm/damon/core: implement damos_migrate_dests free function

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 include/linux/damon.h | 1 +
 mm/damon/core.c       | 7 ++++++-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/include/linux/damon.h b/include/linux/damon.h
index 38ad3b24857f..1cc5f3c35b28 100644
--- a/include/linux/damon.h
+++ b/include/linux/damon.h
@@ -999,6 +999,7 @@ void damos_add_quota_goal(struct damos_quota *q, struct damos_quota_goal *g);
 void damos_destroy_quota_goal(struct damos_quota_goal *goal);
 
 int damos_alloc_migrate_dests(struct damos_migrate_dests *dests, int nr_dests);
+void damos_free_migrate_dests(struct damos_migrate_dests *dests);
 
 struct damos *damon_new_scheme(struct damos_access_pattern *pattern,
 			enum damos_action action,
diff --git a/mm/damon/core.c b/mm/damon/core.c
index c72214195add..19e7566d6ee4 100644
--- a/mm/damon/core.c
+++ b/mm/damon/core.c
@@ -389,13 +389,18 @@ int damos_alloc_migrate_dests(struct damos_migrate_dests *dests, int nr_dests)
 			GFP_KERNEL);
 	if (!dests->weight_arr) {
 		kfree(dests->node_id_arr);
-		dests->node_id_arr = NULL;
 		return -ENOMEM;
 	}
 	dests->nr_dests = nr_dests;
 	return 0;
 }
 
+void damos_free_migrate_dests(struct damos_migrate_dests *dests)
+{
+	kfree(dests->node_id_arr);
+	kfree(dests->weight_arr);
+}
+
 /* initialize fields of @quota that normally API users wouldn't set */
 static struct damos_quota *damos_quota_init(struct damos_quota *quota)
 {
-- 
2.47.3

