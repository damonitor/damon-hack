From: SeongJae Park <sj@kernel.org>
Date: Sat, 29 Nov 2025 12:10:30 -0800
Subject: [PATCH] mm/damon/core: make page_table_scan and
 page_faults_monitoring exclusive

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 mm/damon/core.c | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/mm/damon/core.c b/mm/damon/core.c
index 500059b7b181..018f90505a2b 100644
--- a/mm/damon/core.c
+++ b/mm/damon/core.c
@@ -1417,10 +1417,19 @@ static int damon_commit_report_filters(struct damon_access_check_control *dst,
 	return 0;
 }
 
+static bool damon_primitives_enablement_invalid(
+		struct damon_primitives_enablement *config)
+{
+	return config->page_table_scan == config->page_faults_monitoring;
+}
+
 static int damon_commit_access_check_control(
 		struct damon_access_check_control *dst,
 		struct damon_access_check_control *src)
 {
+	if (damon_primitives_enablement_invalid(&src->primitives_enablement))
+		return -EINVAL;
+
 	dst->primitives_enablement = src->primitives_enablement;
 	return damon_commit_report_filters(dst, src);
 }
-- 
2.47.3

