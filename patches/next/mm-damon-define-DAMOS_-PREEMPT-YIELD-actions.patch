From f8d52055ad8b65a4cf708c4e613c39d974027a60 Mon Sep 17 00:00:00 2001
From: SeongJae Park <sj@kernel.org>
Date: Sun, 5 May 2024 11:55:14 -0700
Subject: [PATCH] mm/damon: define DAMOS_{PREEMPT,YIELD} actions

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 include/linux/damon.h    | 8 ++++++++
 mm/damon/sysfs-schemes.c | 4 ++++
 2 files changed, 12 insertions(+)

diff --git a/include/linux/damon.h b/include/linux/damon.h
index 961b4df672c5..23c83fab5fcd 100644
--- a/include/linux/damon.h
+++ b/include/linux/damon.h
@@ -105,6 +105,10 @@ struct damon_target {
  * @DAMOS_NOHUGEPAGE:	Call ``madvise()`` for the region with MADV_NOHUGEPAGE.
  * @DAMOS_LRU_PRIO:	Prioritize the region on its LRU lists.
  * @DAMOS_LRU_DEPRIO:	Deprioritize the region on its LRU lists.
+#ifdef CONFIG_ACMA
+ * @DAMOS_PREEMPT:	Pass ownership to page reporting subscribers.
+ * @DAMOS_YIELD:	Return ownership to the system.
+#endif
  * @DAMOS_STAT:		Do nothing but count the stat.
  * @NR_DAMOS_ACTIONS:	Total number of DAMOS actions
  *
@@ -122,6 +126,10 @@ enum damos_action {
 	DAMOS_NOHUGEPAGE,
 	DAMOS_LRU_PRIO,
 	DAMOS_LRU_DEPRIO,
+#ifdef CONFIG_ACMA
+	DAMOS_PREEMPT,
+	DAMOS_YIELD,
+#endif
 	DAMOS_STAT,		/* Do nothing but only record the stat */
 	NR_DAMOS_ACTIONS,
 };
diff --git a/mm/damon/sysfs-schemes.c b/mm/damon/sysfs-schemes.c
index bea5bc52846a..a38a60344d16 100644
--- a/mm/damon/sysfs-schemes.c
+++ b/mm/damon/sysfs-schemes.c
@@ -1456,6 +1456,10 @@ static const char * const damon_sysfs_damos_action_strs[] = {
 	"nohugepage",
 	"lru_prio",
 	"lru_deprio",
+#ifdef CONFIG_ACMA
+	"damos_preempt",
+	"damos_yield",
+#endif
 	"stat",
 };
 
-- 
2.39.2

