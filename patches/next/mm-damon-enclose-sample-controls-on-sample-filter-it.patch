From: SeongJae Park <sj@kernel.org>
Date: Sun, 30 Nov 2025 09:32:56 -0800
Subject: [PATCH] mm/damon: enclose sample controls on sample filter iterators

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 include/linux/damon.h | 4 ++--
 mm/damon/core.c       | 3 +--
 2 files changed, 3 insertions(+), 4 deletions(-)

diff --git a/include/linux/damon.h b/include/linux/damon.h
index c7f85f77e6a5..994fead665f5 100644
--- a/include/linux/damon.h
+++ b/include/linux/damon.h
@@ -1012,10 +1012,10 @@ static inline unsigned long damon_sz_region(struct damon_region *r)
 	list_for_each_entry_safe(t, next, &(ctx)->adaptive_targets, list)
 
 #define damon_for_each_sample_filter(f, control) \
-	list_for_each_entry(f, &control->sample_filters, list)
+	list_for_each_entry(f, &(control)->sample_filters, list)
 
 #define damon_for_each_sample_filter_safe(f, next, control) \
-	list_for_each_entry_safe(f, next, &control->sample_filters, list)
+	list_for_each_entry_safe(f, next, &(control)->sample_filters, list)
 
 #define damon_for_each_scheme(s, ctx) \
 	list_for_each_entry(s, &(ctx)->schemes, list)
diff --git a/mm/damon/core.c b/mm/damon/core.c
index 752563a1b006..03552c9dca80 100644
--- a/mm/damon/core.c
+++ b/mm/damon/core.c
@@ -687,8 +687,7 @@ void damon_destroy_ctx(struct damon_ctx *ctx)
 	damon_for_each_scheme_safe(s, next_s, ctx)
 		damon_destroy_scheme(s);
 
-	damon_for_each_sample_filter_safe(f, next_f,
-			(&ctx->sample_control))
+	damon_for_each_sample_filter_safe(f, next_f, &ctx->sample_control)
 		damon_destroy_sample_filter(f, &ctx->sample_control);
 
 	if (ctx->ops_attrs.nr_tids)
-- 
2.47.3

