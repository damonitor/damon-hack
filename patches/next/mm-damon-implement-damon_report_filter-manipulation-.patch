From: SeongJae Park <sj@kernel.org>
Date: Fri, 28 Nov 2025 15:09:22 -0800
Subject: [PATCH] mm/damon: implement damon_report_filter manipulation
 functions

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 include/linux/damon.h |  8 ++++++++
 mm/damon/core.c       | 40 ++++++++++++++++++++++++++++++++++++++++
 2 files changed, 48 insertions(+)

diff --git a/include/linux/damon.h b/include/linux/damon.h
index 4c02fe31c8f4..54b76698cf8f 100644
--- a/include/linux/damon.h
+++ b/include/linux/damon.h
@@ -1085,6 +1085,14 @@ void damon_free_target(struct damon_target *t);
 void damon_destroy_target(struct damon_target *t, struct damon_ctx *ctx);
 unsigned int damon_nr_regions(struct damon_target *t);
 
+struct damon_report_filter *damon_new_report_filter(
+		enum damon_report_filter_type *filter_type, bool matching,
+		bool allow);
+void damon_add_report_filter(struct damon_access_check_control *ctrl,
+		struct damon_report_filter *filter);
+void damon_destroy_report_filter(struct damon_report_filter *filter,
+		struct damon_access_check_control *ctrl);
+
 struct damon_ctx *damon_new_ctx(void);
 void damon_destroy_ctx(struct damon_ctx *ctx);
 int damon_set_attrs(struct damon_ctx *ctx, struct damon_attrs *attrs);
diff --git a/mm/damon/core.c b/mm/damon/core.c
index e4e6588d2dfa..860af57e747a 100644
--- a/mm/damon/core.c
+++ b/mm/damon/core.c
@@ -562,6 +562,46 @@ unsigned int damon_nr_regions(struct damon_target *t)
 	return t->nr_regions;
 }
 
+struct damon_report_filter *damon_new_report_filter(
+		enum damon_report_filter_type *filter_type, bool matcing,
+		bool allow)
+{
+	struct damon_report_filter *filter;
+
+	filter = kmalloc(sizeof(*filter), GFP_KERNEL);
+	if (!filter)
+		return NULL;
+	filter->type = filter_type;
+	filter->matching = matching;
+	filter->allow = allow;
+	INIT_LIST_HEAD(&filter->list);
+	return filter;
+}
+
+void damon_add_report_filter(struct damon_access_check_control *ctrl,
+		struct damon_report_filter *filter)
+{
+	list_add_tail(&filter->list, &ctrl->report_filters);
+}
+
+static void damon_del_report_filter(struct damon_report_filter *f,
+		struct damon_access_check_control *ctrl)
+{
+	list_del(&f->list);
+}
+
+static void damon_free_report_filter(struct damon_report_filter *f)
+{
+	kfree(f);
+}
+
+void damon_destroy_report_filter(struct damon_report_filter *f,
+		struct damon_access_check_control *ctrl)
+{
+	damon_del_report_filter(f, ctrl);
+	damon_free_report_filter(f);
+}
+
 struct damon_ctx *damon_new_ctx(void)
 {
 	struct damon_ctx *ctx;
-- 
2.47.3

