From: SeongJae Park <sj@kernel.org>
Date: Tue, 22 Jul 2025 21:05:37 -0700
Subject: [PATCH] mm/damon/paddr_fault: avoid protecting unaccessible vma

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 mm/damon/paddr.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/mm/damon/paddr.c b/mm/damon/paddr.c
index b65a11ff35e3..adb9fdc9ece3 100644
--- a/mm/damon/paddr.c
+++ b/mm/damon/paddr.c
@@ -104,6 +104,9 @@ static bool damon_pa_fault_change_protection_one(struct folio *folio,
 {
 	struct mmu_gather tlb;
 
+	if (!vma_is_accessible(vma))
+		return true;
+
 	tlb_gather_mmu(&tlb, vma->vm_mm);
 
 	/* TODO: define and use MM_CP_PROT_DAMON */
-- 
2.39.5

