From: SeongJae Park <sj@kernel.org>
Date: Mon, 16 Dec 2024 19:45:27 -0800
Subject: [PATCH] mm/damon: revert passing per-region sz_filter_passed to
 walk_fn()

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 include/linux/damon.h | 2 +-
 mm/damon/core.c       | 7 +++----
 mm/damon/sysfs.c      | 2 +-
 3 files changed, 5 insertions(+), 6 deletions(-)

diff --git a/include/linux/damon.h b/include/linux/damon.h
index 8023d62516bf..70d20db3f3c4 100644
--- a/include/linux/damon.h
+++ b/include/linux/damon.h
@@ -404,7 +404,7 @@ struct damos;
 struct damos_walk_control {
 	void (*walk_fn)(void *data, struct damon_ctx *ctx,
 			struct damon_target *t, struct damon_region *r,
-			struct damos *s, unsigned long sz_filter_passed);
+			struct damos *s);
 	void *data;
 /* private: internal use only */
 	/* informs if the kdamond finished handling of the walk request */
diff --git a/mm/damon/core.c b/mm/damon/core.c
index 59af9a111489..d21d02ee508d 100644
--- a/mm/damon/core.c
+++ b/mm/damon/core.c
@@ -1466,8 +1466,7 @@ static bool damos_filter_out(struct damon_ctx *ctx, struct damon_target *t,
  * installed by damos_walk() and not yet uninstalled, invoke it.
  */
 static void damos_walk_call_walk(struct damon_ctx *ctx, struct damon_target *t,
-		struct damon_region *r, struct damos *s,
-		unsigned long sz_filter_passed)
+		struct damon_region *r, struct damos *s)
 {
 	struct damos_walk_control *control;
 
@@ -1476,7 +1475,7 @@ static void damos_walk_call_walk(struct damon_ctx *ctx, struct damon_target *t,
 	mutex_unlock(&ctx->walk_control_lock);
 	if (!control)
 		return;
-	control->walk_fn(control->data, ctx, t, r, s, sz_filter_passed);
+	control->walk_fn(control->data, ctx, t, r, s);
 }
 
 /*
@@ -1606,7 +1605,7 @@ static void damos_apply_scheme(struct damon_ctx *c, struct damon_target *t,
 			sz_applied = c->ops.apply_scheme(c, t, r, s,
 					&sz_ops_filtered);
 		}
-		damos_walk_call_walk(c, t, r, s, sz_ops_filtered);
+		damos_walk_call_walk(c, t, r, s);
 		ktime_get_coarse_ts64(&end);
 		quota->total_charged_ns += timespec64_to_ns(&end) -
 			timespec64_to_ns(&begin);
diff --git a/mm/damon/sysfs.c b/mm/damon/sysfs.c
index aea1b90ebe32..edac364b3979 100644
--- a/mm/damon/sysfs.c
+++ b/mm/damon/sysfs.c
@@ -1462,7 +1462,7 @@ struct damon_sysfs_schemes_walk_data {
 /* populate the region directory */
 static void damon_sysfs_schemes_tried_regions_upd_one(void *data, struct damon_ctx *ctx,
 		struct damon_target *t, struct damon_region *r,
-		struct damos *s, unsigned long sz_filter_passed)
+		struct damos *s)
 {
 	struct damon_sysfs_schemes_walk_data *walk_data = data;
 	struct damon_sysfs_kdamond *sysfs_kdamond = walk_data->sysfs_kdamond;
-- 
2.39.5

