From: SeongJae Park <sj@kernel.org>
Date: Mon, 29 Dec 2025 22:34:08 -0800
Subject: [PATCH] mm/damon/sysfs: set err for sample filters dir alloc failure

Fixup of "mm/damon/sysfs: implement sample/filters/ directory".

Reported-by: kernel test robot <lkp@intel.com>
Reported-by: Dan Carpenter <error27@gmail.com>
Closes: https://lore.kernel.org/r/202512271918.xuSlfGd4-lkp@intel.com/
Signed-off-by: SeongJae Park <sj@kernel.org>
---
 mm/damon/sysfs.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/mm/damon/sysfs.c b/mm/damon/sysfs.c
index d05083572452..cf0ae45d0a04 100644
--- a/mm/damon/sysfs.c
+++ b/mm/damon/sysfs.c
@@ -1233,8 +1233,10 @@ static int damon_sysfs_sample_add_dirs(
 	sample->primitives = primitives;
 
 	filters = damon_sysfs_sample_filters_alloc();
-	if (!filters)
+	if (!filters) {
+		err = -ENOMEM;
 		goto put_primitives_out;
+	}
 	err = kobject_init_and_add(&filters->kobj,
 			&damon_sysfs_sample_filters_ktype, &sample->kobj,
 			"filters");
-- 
2.47.3

