From: SeongJae Park <sj@kernel.org>
Date: Fri, 15 Nov 2024 13:11:55 -0800
Subject: [PATCH] mm/damon/sysfs: use damon_call() for schemes tried regions
 clear command

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 mm/damon/sysfs.c | 11 ++++++-----
 1 file changed, 6 insertions(+), 5 deletions(-)

diff --git a/mm/damon/sysfs.c b/mm/damon/sysfs.c
index fcab48ea5fde..7155ba226554 100644
--- a/mm/damon/sysfs.c
+++ b/mm/damon/sysfs.c
@@ -1255,9 +1255,9 @@ static int damon_sysfs_upd_schemes_regions_stop(
 	return damon_sysfs_schemes_update_regions_stop(ctx);
 }
 
-static int damon_sysfs_clear_schemes_regions(
-		struct damon_sysfs_kdamond *kdamond)
+static int damon_sysfs_clear_schemes_regions(void *data)
 {
+	struct damon_sysfs_kdamond *kdamond = data;
 	struct damon_ctx *ctx = kdamond->damon_ctx;
 
 	if (!ctx)
@@ -1412,9 +1412,6 @@ static int damon_sysfs_cmd_request_callback(struct damon_ctx *c, bool active,
 			damon_sysfs_schemes_regions_updating = false;
 		}
 		break;
-	case DAMON_SYSFS_CMD_CLEAR_SCHEMES_TRIED_REGIONS:
-		err = damon_sysfs_clear_schemes_regions(kdamond);
-		break;
 	case DAMON_SYSFS_CMD_UPDATE_SCHEMES_EFFECTIVE_QUOTAS:
 		err = damon_sysfs_upd_schemes_effective_quotas(kdamond);
 		break;
@@ -1556,6 +1553,10 @@ static int damon_sysfs_handle_cmd(enum damon_sysfs_cmd cmd,
 		call_req.fn = damon_sysfs_commit_schemes_quota_goals;
 		call_req.arg = kdamond;
 		return damon_call(kdamond->damon_ctx, &call_req);
+	case DAMON_SYSFS_CMD_CLEAR_SCHEMES_TRIED_REGIONS:
+		call_req.fn = damon_sysfs_clear_schemes_regions;
+		call_req.arg = kdamond;
+		return damon_call(kdamond->damon_ctx, &call_req);
 	default:
 		break;
 	}
-- 
2.39.5

