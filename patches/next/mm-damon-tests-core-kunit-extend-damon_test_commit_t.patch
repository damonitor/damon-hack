From: SeongJae Park <sj@kernel.org>
Date: Sat, 11 Oct 2025 12:49:23 -0700
Subject: [PATCH] mm/damon/tests/core-kunit: extend damon_test_commit_targets()

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 mm/damon/tests/core-kunit.h | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/mm/damon/tests/core-kunit.h b/mm/damon/tests/core-kunit.h
index 13f91a0d70d4..6fbf8349e556 100644
--- a/mm/damon/tests/core-kunit.h
+++ b/mm/damon/tests/core-kunit.h
@@ -978,6 +978,16 @@ static void damon_test_commit_targets(struct kunit *test)
 		i++;
 	KUNIT_EXPECT_EQ(test, i, 5);
 
+	damon_nth_target(1, src)->remove_on_commit = true;
+	damon_nth_target(2, src)->remove_on_commit = true;
+	damon_nth_target(4, src)->remove_on_commit = true;
+	err = damon_commit_targets(dst, src);
+	KUNIT_EXPECT_EQ(test, err, 0);
+	i = 0;
+	damon_for_each_target(t, dst)
+		i++;
+	KUNIT_EXPECT_EQ(test, i, 2);
+
 	damon_destroy_ctx(src);
 	damon_destroy_ctx(dst);
 }
-- 
2.39.5

