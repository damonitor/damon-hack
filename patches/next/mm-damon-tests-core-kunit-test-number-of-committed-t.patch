From: SeongJae Park <sj@kernel.org>
Date: Tue, 2 Sep 2025 19:44:49 -0700
Subject: [PATCH] mm/damon/tests/core-kunit: test number of committed targets

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 mm/damon/tests/core-kunit.h | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/mm/damon/tests/core-kunit.h b/mm/damon/tests/core-kunit.h
index 94493d303bb8..cf4c9bcfb295 100644
--- a/mm/damon/tests/core-kunit.h
+++ b/mm/damon/tests/core-kunit.h
@@ -683,13 +683,33 @@ static struct damon_ctx *damon_test_commit_ctx_new_dst_ctx(void)
 	return dst;
 }
 
+static int damon_test_nr_targets(struct damon_ctx *ctx)
+{
+	struct damon_target *target;
+	int i = 0;
+
+	damon_for_each_target(target, ctx)
+		i++;
+	return i;
+}
+
+static void damon_test_commit_ctx_ensure_target_committed(struct kunit *test,
+		struct damon_ctx *dst, struct damon_ctx *src)
+{
+	KUNIT_EXPECT_EQ(test, damon_test_nr_targets(dst),
+			damon_test_nr_targets(src));
+
+}
+
 static void damon_test_commit_ctx_ensure_committed(struct kunit *test,
 		struct damon_ctx *dst, struct damon_ctx *src)
 {
+	/* test if attrs are committed as expected */
 	dst->attrs.aggr_samples = 0;
 	src->attrs.aggr_samples = 0;
 	KUNIT_EXPECT_EQ(test, memcmp(&dst->attrs, &src->attrs,
 				sizeof(src->attrs)), 0);
+	damon_test_commit_ctx_ensure_target_committed(test, dst, src);
 }
 
 static void damon_test_commit_ctx(struct kunit *test)
-- 
2.47.3

