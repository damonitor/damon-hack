From 13ecbb8330df146820a081a688100d749091d8cc Mon Sep 17 00:00:00 2001
From: SeongJae Park <sj@kernel.org>
Date: Thu, 11 Apr 2024 09:12:29 -0700
Subject: [PATCH] mm: fix build errors on CONFIG_TRANSPARENT_HUGEPAGE=N

Closes: https://lore.kernel.org/all/20240410233759.274907-1-sj@kernel.org/
Signed-off-by: Barry Song <v-songbaohua@oppo.com>
Signed-off-by: SeongJae Park <sj@kernel.org>
---
 mm/memory.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/mm/memory.c b/mm/memory.c
index b6fa5146b260..08f2e9b202f0 100644
--- a/mm/memory.c
+++ b/mm/memory.c
@@ -4141,6 +4141,7 @@ vm_fault_t do_swap_page(struct vm_fault *vmf)
 	vmf->pte = pte_offset_map_lock(vma->vm_mm, vmf->pmd, vmf->address,
 			&vmf->ptl);
 
+#ifdef CONFIG_TRANSPARENT_HUGEPAGE
 	/* We hit large folios in swapcache */
 	if (start_pte && folio_test_large(folio) && folio_test_swapcache(folio)) {
 		int nr = folio_nr_pages(folio);
@@ -4170,6 +4171,7 @@ vm_fault_t do_swap_page(struct vm_fault *vmf)
 	}
 
 check_pte:
+#endif
 	if (unlikely(!vmf->pte || !pte_same(ptep_get(vmf->pte), vmf->orig_pte)))
 		goto out_nomap;
 
-- 
2.39.2

