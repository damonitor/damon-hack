From 8608b345647da44a3229bbec0936d42a81b2fa26 Mon Sep 17 00:00:00 2001
From: SeongJae Park <sj@kernel.org>
Date: Fri, 5 Jul 2024 13:49:09 -0700
Subject: [PATCH] mm/gup: temporal fixup for build on CONFIG_MMU unset case

Link: https://lore.kernel.org/20240624063952.1572359-4-vivek.kasireddy@intel.com
Signed-off-by: SeongJae Park <sj@kernel.org>
---
 mm/gup.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/mm/gup.c b/mm/gup.c
index 26273873e8b7..43f6d2f689d2 100644
--- a/mm/gup.c
+++ b/mm/gup.c
@@ -3675,9 +3675,9 @@ long memfd_pin_folios(struct file *memfd, loff_t start, loff_t end,
 				    next_idx != folio_index(fbatch.folios[i]))
 					continue;
 
-				folio = try_grab_folio_fast(&fbatch.folios[i]->page,
-						       1, FOLL_PIN);
-				if (!folio) {
+				folio = page_folio(&fbatch.folios[i]->page);
+
+				if (try_grab_folio(folio, 1, FOLL_PIN)) {
 					folio_batch_release(&fbatch);
 					ret = -EINVAL;
 					goto err;
-- 
2.39.2

