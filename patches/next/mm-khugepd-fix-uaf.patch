From: SeongJae Park <sj@kernel.org>
Date: Mon, 22 Sep 2025 02:20:05 -0700
Subject: [PATCH] mm/khugepd: fix uaf

https://lore.kernel.org/20250922002834.vz6ntj36e75ehkyp@master

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 mm/khugepaged.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/mm/khugepaged.c b/mm/khugepaged.c
index 5907541c8f22..52786ffef80a 100644
--- a/mm/khugepaged.c
+++ b/mm/khugepaged.c
@@ -2508,8 +2508,7 @@ static unsigned int khugepaged_scan_mm_slot(unsigned int pages, int *result,
 		 * mm_slot not pointing to the exiting mm.
 		 */
 		if (!list_is_last(&slot->mm_node, &khugepaged_scan.mm_head)) {
-			slot = list_next_entry(slot, mm_node);
-			khugepaged_scan.mm_slot = slot;
+			khugepaged_scan.mm_slot = list_next_entry(slot, mm_node);
 			khugepaged_scan.address = 0;
 		} else {
 			khugepaged_scan.mm_slot = NULL;
-- 
2.39.5

