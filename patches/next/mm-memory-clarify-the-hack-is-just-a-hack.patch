From: SeongJae Park <sj@kernel.org>
Date: Mon, 1 Dec 2025 22:06:34 -0800
Subject: [PATCH] mm/memory: clarify the hack is just a hack

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 mm/memory.c | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/mm/memory.c b/mm/memory.c
index a317ff8a2346..5dc85adb1e59 100644
--- a/mm/memory.c
+++ b/mm/memory.c
@@ -6173,6 +6173,22 @@ static vm_fault_t wp_huge_pud(struct vm_fault *vmf, pud_t orig_pud)
 	return VM_FAULT_FALLBACK;
 }
 
+/*
+ * NOTE: This is only poc purpose "hack" that will not be upstreamed as is.
+ * More discussions between all stakeholders including maintainers of MM core,
+ * NUMA balancing, and DAMON should be made to make this upstreamable.
+ * (https://lore.kernel.org/20251128193947.80866-1-sj@kernel.org)
+ *
+ * This function is called from page fault handler, for page faults on
+ * P{TE,MD}-protected but vma-accessible pages.  DAMON is making the fake
+ * protection for access sampling purpose.  This function simply clear the
+ * protection and report this access to DAMON, by calling
+ * damon_report_page_fault().
+ *
+ * The protection clear code is copied from NUMA fault handling code for PTE.
+ * Again, this is only poc purpose "hack" to show what information DAMON want
+ * from page fault events, rather than an upstream-aimed version.
+ */
 static vm_fault_t do_damon_page(struct vm_fault *vmf, bool huge_pmd)
 {
 	struct vm_area_struct *vma = vmf->vma;
-- 
2.47.3

