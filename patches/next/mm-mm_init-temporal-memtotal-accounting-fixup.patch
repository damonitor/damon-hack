From: SeongJae Park <sj@kernel.org>
Date: Thu, 25 Sep 2025 02:51:11 -0700
Subject: [PATCH] mm/mm_init: temporal memtotal accounting fixup

Fixes: aa164612ca91 (mm/memblock: correct totalram_pages accounting with KMSAN)
Signed-off-by: SeongJae Park <sj@kernel.org>
---
 mm/mm_init.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/mm/mm_init.c b/mm/mm_init.c
index 69bb1c602d24..559ea9fa6644 100644
--- a/mm/mm_init.c
+++ b/mm/mm_init.c
@@ -2554,7 +2554,7 @@ unsigned long __init memblock_free_pages(struct page *page, unsigned long pfn,
 		int nid = early_pfn_to_nid(pfn);
 
 		if (!early_page_initialised(pfn, nid))
-			return 0;
+			return 1UL << order;
 	}
 
 	if (!kmsan_memblock_free_pages(page, order)) {
-- 
2.39.5

