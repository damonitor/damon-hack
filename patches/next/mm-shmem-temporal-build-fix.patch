From: SeongJae Park <sj@kernel.org>
Date: Wed, 28 Aug 2024 02:28:37 -0700
Subject: [PATCH] mm/shmem: temporal build fix

Link: https://lore.kernel.org/20240828092801.154587-1-sj@kernel.org

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 mm/shmem.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/mm/shmem.c b/mm/shmem.c
index 16099340ca1d..4e70459ed509 100644
--- a/mm/shmem.c
+++ b/mm/shmem.c
@@ -1911,11 +1911,13 @@ static int shmem_replace_folio(struct folio **foliop, gfp_t gfp,
 	 * limit chance of success by further cpuset and node constraints.
 	 */
 	gfp &= ~GFP_CONSTRAINT_MASK;
+#ifdef CONFIG_TRANSPARENT_HUGEPAGE
 	if (nr_pages > 1) {
 		gfp_t huge_gfp = vma_thp_gfp_mask(vma);
 
 		gfp = limit_gfp_mask(huge_gfp, gfp);
 	}
+#endif
 
 	new = shmem_alloc_folio(gfp, folio_order(old), info, index);
 	if (!new)
-- 
2.39.2

