From: SeongJae Park <sj@kernel.org>
Date: Mon, 16 Feb 2026 14:47:24 -0800
Subject: [PATCH] revert mm/damon/core: split regions for min_nr_regions

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 mm/damon/core.c | 39 ++++-----------------------------------
 1 file changed, 4 insertions(+), 35 deletions(-)

diff --git a/mm/damon/core.c b/mm/damon/core.c
index fd1b2cbfe2c80..8e4cf71e2a3ed 100644
--- a/mm/damon/core.c
+++ b/mm/damon/core.c
@@ -1316,40 +1316,6 @@ static unsigned long damon_region_sz_limit(struct damon_ctx *ctx)
 	return sz;
 }
 
-static void damon_split_region_at(struct damon_target *t,
-				  struct damon_region *r, unsigned long sz_r);
-
-/*
- * damon_apply_min_nr_regions() - Make effect of min_nr_regions parameter.
- * @ctx:	monitoring context.
- *
- * This function implement min_nr_regions (minimum number of damon_region
- * objects in the given monitoring context) behavior.  It first calculates
- * maximum size of each region for enforcing the min_nr_regions as total size
- * of the regions divided by the min_nr_regions.  After that, this function
- * splits regions to ensure all regions are equal to or smaller than the size
- * limit.  Finally, this function returns the maximum size limit.
- *
- * Returns: maximum size of each region for convincing min_nr_regions.
- */
-static unsigned long damon_apply_min_nr_regions(struct damon_ctx *ctx)
-{
-	unsigned long max_region_sz = damon_region_sz_limit(ctx);
-	struct damon_target *t;
-	struct damon_region *r, *next;
-
-	max_region_sz = ALIGN(max_region_sz, ctx->min_region_sz);
-	damon_for_each_target(t, ctx) {
-		damon_for_each_region_safe(r, next, t) {
-			while (damon_sz_region(r) > max_region_sz) {
-				damon_split_region_at(t, r, max_region_sz);
-				r = damon_next_region(r);
-			}
-		}
-	}
-	return max_region_sz;
-}
-
 static int kdamond_fn(void *data);
 
 /*
@@ -1706,6 +1672,9 @@ static void kdamond_tune_intervals(struct damon_ctx *c)
 	damon_set_attrs(c, &new_attrs);
 }
 
+static void damon_split_region_at(struct damon_target *t,
+				  struct damon_region *r, unsigned long sz_r);
+
 static bool __damos_valid_target(struct damon_region *r, struct damos *s)
 {
 	unsigned long sz;
@@ -2809,7 +2778,7 @@ static int kdamond_fn(void *data)
 	if (!ctx->regions_score_histogram)
 		goto done;
 
-	sz_limit = damon_apply_min_nr_regions(ctx);
+	sz_limit = damon_region_sz_limit(ctx);
 
 	while (!kdamond_need_stop(ctx)) {
 		/*
-- 
2.47.3

