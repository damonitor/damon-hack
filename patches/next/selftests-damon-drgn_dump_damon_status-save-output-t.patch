From: SeongJae Park <sj@kernel.org>
Date: Sat, 21 Jun 2025 14:02:08 -0700
Subject: [PATCH] selftests/damon/drgn_dump_damon_status: save output to file

Signed-off-by: SeongJae Park <sj@kernel.org>
---
 .../selftests/damon/drgn_dump_damon_status.py       | 13 +++++++++----
 1 file changed, 9 insertions(+), 4 deletions(-)

diff --git a/tools/testing/selftests/damon/drgn_dump_damon_status.py b/tools/testing/selftests/damon/drgn_dump_damon_status.py
index 9bb15b0c276b..333a0d0c4bff 100755
--- a/tools/testing/selftests/damon/drgn_dump_damon_status.py
+++ b/tools/testing/selftests/damon/drgn_dump_damon_status.py
@@ -140,17 +140,22 @@ def damon_ctx_to_dict(ctx):
         ])
 
 def main():
-    if len(sys.argv) < 2:
-        print('Usage: %s <kdamond pid>' % sys.argv[0])
+    if len(sys.argv) < 3:
+        print('Usage: %s <kdamond pid> <file>' % sys.argv[0])
         exit(1)
 
     pid = int(sys.argv[1])
+    file_to_store = sys.argv[2]
 
     kthread_data = cast('struct kthread *',
                         find_task(prog, pid).worker_private).data
     ctx = cast('struct damon_ctx *', kthread_data)
-    print(json.dumps({
-        'contexts': [damon_ctx_to_dict(ctx)]}, indent=4))
+    status = {'contexts': [damon_ctx_to_dict(ctx)]}
+    if file_to_store == 'stdout':
+        print(json.dumps(status, indent=4))
+    else:
+        with open(file_to_store, 'w') as f:
+            json.dump(status, f, indent=4)
 
 if __name__ == '__main__':
     main()
-- 
2.39.5

