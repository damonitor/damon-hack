From hackermail Thu Jan  1 00:00:00 1970
From: SeongJae Park <sj@kernel.org>
To: Andrew Morton <akpm@linux-foundation.org>
Cc: SeongJae Park <sj@kernel.org>
Cc: Shuah Khan <shuah@kernel.org>
Cc: damon@lists.linux.dev
Cc: kernel-team@meta.com
Cc: linux-kernel@vger.kernel.org
Cc: linux-kselftest@vger.kernel.org
Cc: linux-mm@kvack.org
Date: Sun, 20 Jul 2025 10:15:30 -0700
Subject: [PATCH 00/22] selftests/damon/sysfs.py: test all parameters

sysfs.py tests if DAMON sysfs interface is passing the user-requested
parameters to DAMON as expected.  But only the default (minimum)
parameters are being tested.  This is partially because _damon_sysfs.py,
which is the library for making the parameter requests, is not
supporting the entire parameters.  The internal DAMON status dump script
(drgn_dump_damon_status.py) is also not dumping entire parameters.
Extend the test coverage by updating parameters input and status dumping
scripts to support all parameters, and writing additional tests using
those.

This increased test coverage actually found one real bug
(https://lore.kernel.org/20250719181932.72944-1-sj@kernel.org).

First seven patches (1-7) extend _damon_sysfs.py for all parameters
setup.  The eight patch (8) fixes _damon_sysfs.py to use correct max
nr_acceses and age values for their type.  Following three patches
(9-11) extend drgn_dump_damon_status.py to dump full DAMON parameters.
Following nine patches (12-20) refactor sysfs.py for general testing
code reuse, and extend it for full parameters check.  Finally, two
patches (21 and 22) add test cases in sysfs.py for full parameters
testing.

SeongJae Park (22):
  selftests/damon/_damon_sysfs: support DAMOS watermarks setup
  selftests/damon/_damon_sysfs: support DAMOS filters setup
  selftests/damon/_damon_sysfs: support monitoring intervals goal setup
  selftests/damon/_damon_sysfs: support DAMOS quota weights setup
  selftests/damon/_damon_sysfs: support DAMOS quota goal nid setup
  selftests/damon/_damon_sysfs: support DAMOS action dests setup
  selftests/damon/_damon_sysfs: support DAMOS target_nid setup
  selftests/damon/_damon_sysfs: use 2**32 - 1 as max nr_accesses and age
  selftests/damon/drgn_dump_damon_status: dump damos->migrate_dests
  selftests/damon/drgn_dump_damon_status: dump ctx->ops.id
  selftests/damon/drgn_dump_damon_status: dump DAMOS filters
  selftests/damon/sysfs.py: generalize DAMOS Watermarks commit assertion
  selftests/damon/sysfs.py: generalize DamosQuota commit assertion
  selftests/damon/sysfs.py: test quota goal commitment
  selftests/damon/sysfs.py: test DAMOS destinations commitment
  selftests/damon/sysfs.py: generalize DAMOS schemes commit assertion
  selftests/damon/sysfs.py: test DAMOS filters commitment
  selftests/damon/sysfs.py: generalize DAMOS schemes commit assertion
  selftests/damon/sysfs.py: generalize monitoring attributes commit
    assertion
  selftests/damon/sysfs.py: generalize DAMON context commit assertion
  selftests/damon/sysfs.py: test non-default parameters runtime commit
  selftests/damon/sysfs.py: test runtime reduction of DAMON parameters

 tools/testing/selftests/damon/_damon_sysfs.py | 301 +++++++++++++++++-
 .../selftests/damon/drgn_dump_damon_status.py |  63 +++-
 tools/testing/selftests/damon/sysfs.py        | 284 +++++++++++++----
 3 files changed, 568 insertions(+), 80 deletions(-)


base-commit: fc8066077f44a4fd43f8fdb12bc238f8fbeaa3c5
-- 
2.39.5
